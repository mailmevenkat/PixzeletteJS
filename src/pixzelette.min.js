/* PixzeletteJS | 2014 | mailmevenkat25(at)gmail(dot)com */ (function(){function e(e,t,n){var r,i,s,o;min=Math.min(e,t,n);max=Math.max(e,t,n);s=max;o=max-min;if(max!=0)i=o/max;else{i=0;r=-1;return{hue:r,saturation:i,value:undefined}}if(e===max)r=(t-n)/o;else if(t===max)r=2+(n-e)/o;else r=4+(e-t)/o;r*=60;if(r<0)r+=360;if(isNaN(r))r=0;return{hue:r,saturation:i,value:s}}function n(e,n,r){var i;var s,o,u;if(n===0){s=o=u=r;return{red:s,green:o,blue:u}}e/=60;i=Math.floor(e);f=e-i;p=r*(1-n);q=r*(1-n*f);t=r*(1-n*(1-f));switch(i){case 0:s=r;o=t;u=p;break;case 1:s=q;o=r;u=p;break;case 2:s=p;o=r;u=t;break;case 3:s=p;o=q;u=r;break;case 4:s=t;o=p;u=r;break;default:s=r;o=p;u=q;break}return{red:s,green:o,blue:u}}function r(e,t,n,r,i,s,o){var u=document.createElement("canvas");u.width=o.canvas.width;u.height=o.canvas.height;var a=u.getContext("2d");a.rect(0,0,u.width,u.height);var f=a.createRadialGradient(e,t,n,e,t,r);f.addColorStop(0,i);f.addColorStop(1,s);a.fillStyle=f;a.fill();gImage=new Image;gImage.src=u.toDataURL();return gImage}function i(e,t,n,r){var i={w:t.canvas.width,h:t.canvas.height};e=new Pixzelette(e,i);var s=typeof r!=="undefined"?r:0;if(e==null)return this;if(n=="addition"){for(var o=0;o<t.pixels.data.length;o+=4){t.pixels.data[o]+=e.pixels.data[o]*s;t.pixels.data[o+1]+=e.pixels.data[o+1]*s;t.pixels.data[o+2]+=e.pixels.data[o+2]*s}}if(n=="subtract"){for(var o=0;o<t.pixels.data.length;o+=4){t.pixels.data[o]-=e.pixels.data[o]*s;t.pixels.data[o+1]-=e.pixels.data[o+1]*s;t.pixels.data[o+2]-=e.pixels.data[o+2]*s}}if(n=="divide"){for(var o=0;o<t.pixels.data.length;o+=4){t.pixels.data[o]+=255*s-e.pixels.data[o];t.pixels.data[o+1]+=255*s-e.pixels.data[o+1];t.pixels.data[o+2]+=255*s-e.pixels.data[o+2]}}return t.pixels;}this.Pixzelette=function(e,t){this.canvas=null;this.context=null;this.pixels=null;this.image=new Image;this.args={w:e.naturalWidth,h:e.naturalHeight,x:0,y:0};var n=e.nodeName.toLowerCase()==="img";var r=e.nodeName.toLowerCase()==="canvas";if(typeof t!=="undefined"){this.args.w=typeof t.w!=="undefined"?t.w:this.args.w;this.args.h=typeof t.h!=="undefined"?t.h:this.args.h;this.args.x=typeof t.x!=="undefined"?t.x:this.args.x;this.args.y=typeof t.y!=="undefined"?t.y:this.args.y}if(n){this.canvas=document.createElement("canvas");this.canvas.width=this.args.w;this.canvas.height=this.args.h;this.context=this.canvas.getContext("2d");this.context.drawImage(e,this.args.x,this.args.y)}else if(r){this.canvas=e;this.context=this.canvas.getContext("2d")}else{return null}this.pixels=this.getImageData();this.image.width=this.canvas.width;this.image.height=this.canvas.height;return this};Pixzelette.prototype.effect=function(t){var r;if(t==null){return this}if(typeof t.brightness!=="undefined"){var i=Math.max(Math.min(t.brightness*255,255),-255)}if(typeof t.contrast!=="undefined"){t.contrast=Math.max(Math.min(t.contrast*128,128),-128);var s=259*(t.contrast+255)/(255*(259-t.contrast))}if(typeof t.sepia!=="undefined"){var o=t.sepia}if(typeof t.hue!=="undefined"){var u=t.hue}if(typeof t.saturate!=="undefined"){var a=t.saturate}if(typeof t.value!=="undefined"){var f=t.value}if(typeof t.red!=="undefined"){var l=Math.max(Math.min(t.red*255,255),-255)}if(typeof t.green!=="undefined"){var c=Math.max(Math.min(t.green*255,255),-255)}if(typeof t.blue!=="undefined"){var h=Math.max(Math.min(t.blue*255,255),-255)}if(typeof t.alpha!=="undefined"){var p=t.alpha}if(typeof t.desaturate!=="undefined"){var d=t.desaturate}for(var v=0;v<this.pixels.data.length;v+=4){for(var m in t){if(m=="brightness"){this.pixels.data[v]+=i;this.pixels.data[v+1]+=i;this.pixels.data[v+2]+=i}if(m=="contrast"){this.pixels.data[v]=s*(this.pixels.data[v]-128)+128;this.pixels.data[v+1]=s*(this.pixels.data[v+1]-128)+128;this.pixels.data[v+2]=s*(this.pixels.data[v+2]-128)+128}if(m=="sepia"){this.pixels.data[v]=(this.pixels.data[v]*.393+this.pixels.data[v+1]*.769+this.pixels.data[v+2]*.189)*o;this.pixels.data[v+1]=(this.pixels.data[v]*.349+this.pixels.data[v+1]*.686+this.pixels.data[v+2]*.168)*o;this.pixels.data[v+2]=(this.pixels.data[v]*.272+this.pixels.data[v+1]*.534+this.pixels.data[v+2]*.131)*o}if(m=="hue"){r=e(this.pixels.data[v],this.pixels.data[v+1],this.pixels.data[v+2]);r.hue*=u;r=n(r.hue,r.saturation,r.value);this.pixels.data[v]=r.red;this.pixels.data[v+1]=r.green;this.pixels.data[v+2]=r.blue}if(m=="saturate"){r=e(this.pixels.data[v],this.pixels.data[v+1],this.pixels.data[v+2]);r.saturation*=a;r=n(r.hue,r.saturation,r.value);this.pixels.data[v]=r.red;this.pixels.data[v+1]=r.green;this.pixels.data[v+2]=r.blue}if(m=="value"){r=e(this.pixels.data[v],this.pixels.data[v+1],this.pixels.data[v+2]);r.value*=f;r=n(r.hue,r.saturation,r.value);this.pixels.data[v]=r.red;this.pixels.data[v+1]=r.green;this.pixels.data[v+2]=r.blue}if(m=="red"){this.pixels.data[v]+=l;this.pixels.data[v+1]-=l;this.pixels.data[v+2]-=l}if(m=="green"){this.pixels.data[v]-=c;this.pixels.data[v+1]+=c;this.pixels.data[v+2]-=c}if(m=="blue"){this.pixels.data[v]-=h;this.pixels.data[v+1]-=h;this.pixels.data[v+2]+=h}if(m=="alpha"){this.pixels.data[v+3]*=p}if(m=="desaturate"){var g=.3*this.pixels.data[v]+.59*this.pixels.data[v+1]+.11*this.pixels.data[v+2];this.pixels.data[v]=this.pixels.data[v+1]=this.pixels.data[v+2]=g*d}}}this.context.putImageData(this.pixels,0,0);return this};Pixzelette.prototype.blend=function(e,t,n){var r=e.nodeName.toLowerCase()==="img";var s=e.nodeName.toLowerCase()==="canvas";if(!r&&!s)return this;switch(t){case"addition":this.context.putImageData(i(e,this,"addition",n),0,0);return this;case"subtract":this.context.putImageData(i(e,this,"subtract",n),0,0);return this;case"multiply":this.context.globalCompositeOperation="multiply";break;case"divide":this.context.putImageData(i(e,this,"divide",n),0,0);return this;case"overlay":this.context.globalCompositeOperation="overlay";break;case"screen":this.context.globalCompositeOperation="screen";break;case"darken":this.context.globalCompositeOperation="darken";break;case"lighten":this.context.globalCompositeOperation="lighten";break;case"dodge":this.context.globalCompositeOperation="color-dodge";break;case"burn":this.context.globalCompositeOperation="color-burn";break;case"soft light":this.context.globalCompositeOperation="soft-light";break;case"hard light":this.context.globalCompositeOperation="hard-light";break;case"difference":this.context.globalCompositeOperation="difference";break;case"exclusion":this.context.globalCompositeOperation="exclusion";break;case"hue":this.context.globalCompositeOperation="hue";break;case"saturation":this.context.globalCompositeOperation="saturation";break;case"color":this.context.globalCompositeOperation="color";break;case"luminosity":this.context.globalCompositeOperation="luminosity";break}if(typeof n!=="undefined")this.context.globalAlpha=n;if(s)e=e.toDataURL();this.context.drawImage(e,0,0);this.pixels=this.getImageData();this.context.globalCompositeOperation="source-over";this.context.globalAlpha=1;return this};Pixzelette.prototype.filter=function(e){switch(e){case"antiq":this.effect({sepia:.7,brightness:.2});break;case"aqua":this.effect({brightness:.1,saturate:2,blue:.08});break;case"beat":this.custom("vignette",.8).effect({red:.05,blue:.05}).custom("orange",.6);break;case"cassie":this.custom("vignette",.8).effect({red:.05,blue:.1}).custom("cream",.4);break;case"deveil":this.effect({red:.05,sepia:.35,brightness:.37,contrast:.8});break;case"ember":this.effect({sepia:.6,brightness:.21,contrast:.4,red:.2}).effect({brightness:.15}).custom("vignette",.7);break;case"evening":this.effect({contrast:.5,red:.1,green:.1}).custom("blue",.4);break;case"hello":this.effect({sepia:1.1,brightness:-.1,contrast:.1});break;case"may":this.effect({contrast:.2,red:.07,blue:.07}).custom("cream",.4);break;case"natalie":this.effect({saturate:.35,contrast:.1});break;case"nilam":this.effect({contrast:-.1,green:.05,blue:.07,brightness:.1});break;case"retro":this.effect({red:.1,green:.07,blue:.1,contrast:.1,brightness:.25});break;case"shallow":this.effect({saturate:1.4,contrast:.3,desaturate:1,brightness:.2}).custom("vignette",.4);break;case"sketchy":this.effect({desaturate:2.5});break;case"tamil":this.effect({contrast:-.1,brightness:.1,saturate:2,red:.08,blue:.08}).custom("orange",.4);break;case"valet":this.custom("vignette",.8).effect({sepia:.9}).custom("purple",.6);break;case"zephyr":this.effect({brightness:.1,green:.02,red:.08});break;default:this.effect()}this.context.putImageData(this.pixels,0,0);return this};Pixzelette.prototype.custom=function(e,t){var n=1;var i=Math.sqrt((Math.pow(this.canvas.width,2)+Math.pow(this.canvas.height,2))/2);if(typeof t!=="undefined")n=t;switch(e){case"vignette":var s=r(this.canvas.width/2,this.canvas.height/2,i/3,i/1.25,"rgba(0,0,0,0)","rgba(0,0,0,1)",this);this.blend(s,"darken",n);break;case"red":var s=r(this.canvas.width/2,this.canvas.height/2,1,i/1.5,"rgba(255,0,0,0.5)","rgba(0,0,0,0.2)",this);this.blend(s,"addition",n);break;case"green":var s=r(this.canvas.width/2,this.canvas.height/2,1,i/1.5,"rgba(0,255,0,0.5)","rgba(0,0,0,0.2)",this);this.blend(s,"addition",n);break;case"blue":var s=r(this.canvas.width/2,this.canvas.height/2,1,i/1.5,"rgba(0,0,255,0.5)","rgba(0,0,0,0.2)",this);this.blend(s,"addition",n);break;case"orange":var s=r(this.canvas.width/2,this.canvas.height/2,1,i/1.5,"rgba(255,165,0,0.5)","rgba(0,0,0,0.2)",this);this.blend(s,"addition",n);break;case"purple":var s=r(this.canvas.width/2,this.canvas.height/2,1,i/1.5,"rgba(128,0,128,0.5)","rgba(0,0,0,0.2)",this);this.blend(s,"addition",n);break;case"yellow":var s=r(this.canvas.width/2,this.canvas.height/2,1,i/1.5,"rgba(255,255,102,0.5)","rgba(0,0,0,0.2)",this);this.blend(s,"addition",n);break;case"cream":var s=r(this.canvas.width/2,this.canvas.height/2,1,i/1.5,"rgba(255,255,204,0.5)","rgba(0,0,0,0.2)",this);this.blend(s,"addition",n);break}this.context.putImageData(this.pixels,0,0);return this};Pixzelette.prototype.getCanvas=function(){return this.canvas};Pixzelette.prototype.getImage=function(e,t){var n="png";var r=1;var i=null;if(typeof e!="undefined")n=e;if(typeof t!="undefined")r=t;switch(n){case"png":i=this.canvas.toDataURL("image/png",r);break;case"jpg":case"jpeg":i=this.canvas.toDataURL("image/jpeg",r);break;case"webp":i=this.canvas.toDataURL("image/webp",r);break;case"default":i=this.canvas.toDataURL();break}this.image.src=i;return this.image};Pixzelette.prototype.getDataURL=function(e,t){return this.getImage(e,t).src};Pixzelette.prototype.getImageData=function(){return this.context.getImageData(0,0,this.canvas.width,this.canvas.height)};})()