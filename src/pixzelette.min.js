(function(){function e(e,t,n){var r,i,s,o;min=Math.min(e,t,n);max=Math.max(e,t,n);s=max;o=max-min;if(max!=0)i=o/max;else{i=0;r=-1;return{hue:r,saturation:i,value:undefined}}if(e===max)r=(t-n)/o;else if(t===max)r=2+(n-e)/o;else r=4+(e-t)/o;r*=60;if(r<0)r+=360;if(isNaN(r))r=0;return{hue:r,saturation:i,value:s}}function n(e,n,r){var i;var s,o,u;if(n===0){s=o=u=r;return{red:s,green:o,blue:u}}e/=60;i=Math.floor(e);f=e-i;p=r*(1-n);q=r*(1-n*f);t=r*(1-n*(1-f));switch(i){case 0:s=r;o=t;u=p;break;case 1:s=q;o=r;u=p;break;case 2:s=p;o=r;u=t;break;case 3:s=p;o=q;u=r;break;case 4:s=t;o=p;u=r;break;default:s=r;o=p;u=q;break}return{red:s,green:o,blue:u}}function r(e,t,n,r,i,s,o){var u=document.createElement("canvas");u.width=o.canvas.width;u.height=o.canvas.height;var a=u.getContext("2d");a.rect(0,0,u.width,u.height);var f=a.createRadialGradient(e,t,n,e,t,r);f.addColorStop(0,i);f.addColorStop(1,s);a.fillStyle=f;a.fill();gImage=new Image;gImage.src=u.toDataURL();return gImage}function i(e,t,n,r){var i={w:t.canvas.width,h:t.canvas.height};e=new Pixzelette(e,i);var s=typeof r!=="undefined"?r:0;if(e==null)return t;if(n=="addition"){for(var o=0;o<t.pixels.data.length;o+=4){t.pixels.data[o]+=e.pixels.data[o]*s;t.pixels.data[o+1]+=e.pixels.data[o+1]*s;t.pixels.data[o+2]+=e.pixels.data[o+2]*s}}if(n=="subtract"){for(var o=0;o<t.pixels.data.length;o+=4){t.pixels.data[o]-=e.pixels.data[o]*s;t.pixels.data[o+1]-=e.pixels.data[o+1]*s;t.pixels.data[o+2]-=e.pixels.data[o+2]*s}}if(n=="divide"){for(var o=0;o<t.pixels.data.length;o+=4){t.pixels.data[o]+=255*s-e.pixels.data[o];t.pixels.data[o+1]+=255*s-e.pixels.data[o+1];t.pixels.data[o+2]+=255*s-e.pixels.data[o+2]}}return t.pixels}this.Pixzelette=function(e,t,n){if(typeof e==undefined||e==null)return null;this.canvas=null;this.context=null;this.pixels=null;this.image=new Image;this.args={w:e.naturalWidth,h:e.naturalHeight,x:0,y:0};var r=e.nodeName.toLowerCase()==="img";var i=e.nodeName.toLowerCase()==="canvas";if(typeof t!=="undefined"&&t!=null){this.args.w=typeof t.w!=="undefined"?t.w:this.args.w;this.args.h=typeof t.h!=="undefined"?t.h:this.args.h;this.args.x=typeof t.x!=="undefined"?t.x:this.args.x;this.args.y=typeof t.y!=="undefined"?t.y:this.args.y}if(r){this.canvas=document.createElement("canvas");this.canvas.width=this.args.w;this.canvas.height=this.args.h;this.context=this.canvas.getContext("2d");this.context.drawImage(e,this.args.x,this.args.y)}else if(i){this.canvas=e;this.context=this.canvas.getContext("2d")}else{return null}this.pixels=this.getImageData();this.image.width=this.canvas.width;this.image.height=this.canvas.height;if(typeof n=="function")n(this);return this};Pixzelette.prototype.effect=function(t,r){var i;if(t==null){return this}if(typeof t.brightness!=="undefined"){var s=Math.max(Math.min(t.brightness*255,255),-255)}if(typeof t.contrast!=="undefined"){t.contrast=Math.max(Math.min(t.contrast*128,128),-128);var o=259*(t.contrast+255)/(255*(259-t.contrast))}if(typeof t.sepia!=="undefined"){var u=t.sepia}if(typeof t.hue!=="undefined"){var a=t.hue}if(typeof t.saturate!=="undefined"){var f=t.saturate}if(typeof t.value!=="undefined"){var l=t.value}if(typeof t.red!=="undefined"){var c=Math.max(Math.min(t.red*255,255),-255)}if(typeof t.green!=="undefined"){var h=Math.max(Math.min(t.green*255,255),-255)}if(typeof t.blue!=="undefined"){var p=Math.max(Math.min(t.blue*255,255),-255)}if(typeof t.alpha!=="undefined"){var d=t.alpha}if(typeof t.desaturate!=="undefined"){var v=t.desaturate}for(var m=0;m<this.pixels.data.length;m+=4){for(var g in t){if(g=="brightness"){this.pixels.data[m]+=s;this.pixels.data[m+1]+=s;this.pixels.data[m+2]+=s}if(g=="contrast"){this.pixels.data[m]=o*(this.pixels.data[m]-128)+128;this.pixels.data[m+1]=o*(this.pixels.data[m+1]-128)+128;this.pixels.data[m+2]=o*(this.pixels.data[m+2]-128)+128}if(g=="sepia"){this.pixels.data[m]=(this.pixels.data[m]*.393+this.pixels.data[m+1]*.769+this.pixels.data[m+2]*.189)*u;this.pixels.data[m+1]=(this.pixels.data[m]*.349+this.pixels.data[m+1]*.686+this.pixels.data[m+2]*.168)*u;this.pixels.data[m+2]=(this.pixels.data[m]*.272+this.pixels.data[m+1]*.534+this.pixels.data[m+2]*.131)*u}if(g=="hue"){i=e(this.pixels.data[m],this.pixels.data[m+1],this.pixels.data[m+2]);i.hue*=a;i=n(i.hue,i.saturation,i.value);this.pixels.data[m]=i.red;this.pixels.data[m+1]=i.green;this.pixels.data[m+2]=i.blue}if(g=="saturate"){i=e(this.pixels.data[m],this.pixels.data[m+1],this.pixels.data[m+2]);i.saturation*=f;i=n(i.hue,i.saturation,i.value);this.pixels.data[m]=i.red;this.pixels.data[m+1]=i.green;this.pixels.data[m+2]=i.blue}if(g=="value"){i=e(this.pixels.data[m],this.pixels.data[m+1],this.pixels.data[m+2]);i.value*=l;i=n(i.hue,i.saturation,i.value);this.pixels.data[m]=i.red;this.pixels.data[m+1]=i.green;this.pixels.data[m+2]=i.blue}if(g=="red"){this.pixels.data[m]+=c;this.pixels.data[m+1]-=c;this.pixels.data[m+2]-=c}if(g=="green"){this.pixels.data[m]-=h;this.pixels.data[m+1]+=h;this.pixels.data[m+2]-=h}if(g=="blue"){this.pixels.data[m]-=p;this.pixels.data[m+1]-=p;this.pixels.data[m+2]+=p}if(g=="alpha"){this.pixels.data[m+3]*=d}if(g=="desaturate"){var y=.3*this.pixels.data[m]+.59*this.pixels.data[m+1]+.11*this.pixels.data[m+2];this.pixels.data[m]=this.pixels.data[m+1]=this.pixels.data[m+2]=y*v}}}this.context.putImageData(this.pixels,0,0);if(typeof r=="function")r(this);return this};Pixzelette.prototype.blend=function(e,t,n,r){var s=e.nodeName.toLowerCase()==="img";var o=e.nodeName.toLowerCase()==="canvas";if(!s&&!o)return this;switch(t){case"addition":this.context.putImageData(i(e,this,"addition",n),0,0);return this;case"subtract":this.context.putImageData(i(e,this,"subtract",n),0,0);return this;case"multiply":this.context.globalCompositeOperation="multiply";break;case"divide":this.context.putImageData(i(e,this,"divide",n),0,0);return this;case"overlay":this.context.globalCompositeOperation="overlay";break;case"screen":this.context.globalCompositeOperation="screen";break;case"darken":this.context.globalCompositeOperation="darken";break;case"lighten":this.context.globalCompositeOperation="lighten";break;case"dodge":this.context.globalCompositeOperation="color-dodge";break;case"burn":this.context.globalCompositeOperation="color-burn";break;case"soft light":this.context.globalCompositeOperation="soft-light";break;case"hard light":this.context.globalCompositeOperation="hard-light";break;case"difference":this.context.globalCompositeOperation="difference";break;case"exclusion":this.context.globalCompositeOperation="exclusion";break;case"hue":this.context.globalCompositeOperation="hue";break;case"saturation":this.context.globalCompositeOperation="saturation";break;case"color":this.context.globalCompositeOperation="color";break;case"luminosity":this.context.globalCompositeOperation="luminosity";break}if(typeof n!=="undefined")this.context.globalAlpha=n;if(o)e=e.toDataURL();this.context.drawImage(e,0,0);this.pixels=this.getImageData();this.context.globalCompositeOperation="source-over";this.context.globalAlpha=1;if(typeof r=="function")r(this);return this};Pixzelette.prototype.filter=function(e,t){switch(e){case"antiq":this.effect({sepia:.7,brightness:.2});break;case"aqua":this.effect({brightness:.1,saturate:2,blue:.08});break;case"beat":this.custom("vignette",.8).effect({red:.05,blue:.05}).custom("orange",.6);break;case"cassie":this.custom("vignette",.8).effect({red:.05,blue:.1}).custom("cream",.4);break;case"deveil":this.effect({red:.05,sepia:.35,brightness:.37,contrast:.8});break;case"ember":this.effect({sepia:.6,brightness:.21,contrast:.4,red:.2}).effect({brightness:.15}).custom("vignette",.7);break;case"evening":this.effect({contrast:.5,red:.1,green:.1}).custom("blue",.4);break;case"hello":this.effect({sepia:1.1,brightness:-.1,contrast:.1});break;case"may":this.effect({contrast:.2,red:.07,blue:.07}).custom("cream",.4);break;case"natalie":this.effect({saturate:.35,contrast:.1});break;case"nilam":this.effect({contrast:-.1,green:.05,blue:.07,brightness:.1});break;case"retro":this.effect({red:.1,green:.07,blue:.1,contrast:.1,brightness:.25});break;case"shallow":this.effect({saturate:1.4,contrast:.3,desaturate:1,brightness:.2}).custom("vignette",.4);break;case"sketchy":this.effect({desaturate:2.5});break;case"tamil":this.effect({contrast:-.1,brightness:.1,saturate:2,red:.08,blue:.08}).custom("orange",.4);break;case"valet":this.custom("vignette",.8).effect({sepia:.9}).custom("purple",.6);break;case"zephyr":this.effect({brightness:.1,green:.02,red:.08});break;default:this.effect()}if(typeof t=="function")t(this);this.context.putImageData(this.pixels,0,0);return this};Pixzelette.prototype.custom=function(e,t,n){var i=1;var s=Math.sqrt((Math.pow(this.canvas.width,2)+Math.pow(this.canvas.height,2))/2);if(typeof t!=="undefined"&t!=null)i=t;switch(e){case"vignette":var o=r(this.canvas.width/2,this.canvas.height/2,s/3,s/1.25,"rgba(0,0,0,0)","rgba(0,0,0,1)",this);this.blend(o,"darken",i);break;case"red":var o=r(this.canvas.width/2,this.canvas.height/2,1,s/1.5,"rgba(255,0,0,0.5)","rgba(0,0,0,0.2)",this);this.blend(o,"addition",i);break;case"green":var o=r(this.canvas.width/2,this.canvas.height/2,1,s/1.5,"rgba(0,255,0,0.5)","rgba(0,0,0,0.2)",this);this.blend(o,"addition",i);break;case"blue":var o=r(this.canvas.width/2,this.canvas.height/2,1,s/1.5,"rgba(0,0,255,0.5)","rgba(0,0,0,0.2)",this);this.blend(o,"addition",i);break;case"orange":var o=r(this.canvas.width/2,this.canvas.height/2,1,s/1.5,"rgba(255,165,0,0.5)","rgba(0,0,0,0.2)",this);this.blend(o,"addition",i);break;case"purple":var o=r(this.canvas.width/2,this.canvas.height/2,1,s/1.5,"rgba(128,0,128,0.5)","rgba(0,0,0,0.2)",this);this.blend(o,"addition",i);break;case"yellow":var o=r(this.canvas.width/2,this.canvas.height/2,1,s/1.5,"rgba(255,255,102,0.5)","rgba(0,0,0,0.2)",this);this.blend(o,"addition",i);break;case"cream":var o=r(this.canvas.width/2,this.canvas.height/2,1,s/1.5,"rgba(255,255,204,0.5)","rgba(0,0,0,0.2)",this);this.blend(o,"addition",i);break}this.context.putImageData(this.pixels,0,0);if(typeof n=="function")n(this);return this};Pixzelette.prototype.getCanvas=function(){return this.canvas};Pixzelette.prototype.getImage=function(e,t){var n="png";var r=1;var i=null;if(typeof e!="undefined")n=e;if(typeof t!="undefined")r=t;switch(n){case"png":i=this.canvas.toDataURL("image/png",r);break;case"jpg":case"jpeg":i=this.canvas.toDataURL("image/jpeg",r);break;case"webp":i=this.canvas.toDataURL("image/webp",r);break;case"default":i=this.canvas.toDataURL();break}this.image.src=i;return this.image};Pixzelette.prototype.getDataURL=function(e,t){return this.getImage(e,t).src};Pixzelette.prototype.getImageData=function(){return this.context.getImageData(0,0,this.canvas.width,this.canvas.height)};})()